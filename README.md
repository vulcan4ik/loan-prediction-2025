#  Loan Payback Prediction

> –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã –∫—Ä–µ–¥–∏—Ç–∞ —Å –ø–æ–º–æ—â—å—é CatBoost  
> **Kaggle Playground Series S5E11 | Score: 0.92317 (ROC-AUC)**  
> **ROC-AUC: 0.92322 | F1-score: 0.944 | Recall: 0.89 | 25 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ + 5-Fold CV**

[![Kaggle](https://img.shields.io/badge/Kaggle-Playground%20Series%20S5E11-20BEFF?style=flat&logo=kaggle)](https://www.kaggle.com/competitions/playground-series-s5e11)
[![Score](https://img.shields.io/badge/Kaggle%20Score-0.92317-3DDC84?style=flat)]()

- [x] SHAP –∞–Ω–∞–ª–∏–∑ –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏  
---

##  –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å–≤—è—â—ë–Ω **–æ—Ü–µ–Ω–∫–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞** –∑–∞—ë–º—â–∏–∫–æ–º –ø–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º.  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **CatBoost**, —É—Å—Ç–æ–π—á–∏–≤—ã–π –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∏ –¥–∏—Å–±–∞–ª–∞–Ω—Å—É –∫–ª–∞—Å—Å–æ–≤.  

–ú–æ–¥–µ–ª—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **ROC-AUC = 0.923**, —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—è –Ω–∞–¥—ë–∂–Ω—ã—Ö –∏ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.  
–°–æ–∑–¥–∞–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è **Kaggle Playground Series S5E11**.

---

##  –ó–∞–¥–∞—á–∞

**–ë–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- `1` ‚Äî –∫—Ä–µ–¥–∏—Ç –≤—ã–ø–ª–∞—á–µ–Ω  
- `0` ‚Äî –¥–µ—Ñ–æ–ª—Ç  

 **–î–∏—Å–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤:** 80% –≤—ã–ø–ª–∞—Ç–∏–≤—à–∏—Ö vs 20% –Ω–µ–≤—ã–ø–ª–∞—Ç–∏–≤—à–∏—Ö  
 **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:** 594k train / 148k test  

---

##  –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è

### 1. **EDA**
- –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –¥–æ—Ö–æ–¥–∞, –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –ø–æ –∫—Ä–µ–¥–∏—Ç—É.  
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: `employment_status`, `education_level`, `loan_purpose`.  
- –í—ã—è–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤ –º–µ—Ç–æ–¥–æ–º IQR –∏ PHIK-–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

### 2. **Feature Engineering (13 –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤)**

```
loan_to_income = loan_amount / annual_income
debt_interest_ratio = (loan_amount * (1 + interest_rate/100)) / annual_income
credit_risk_index = credit_score * (1 - debt_to_income_ratio)
loan_income_stress = loan_amount / (annual_income * debt_to_income_ratio)
log_annual_income = log1p(annual_income)
log_loan_amount = log1p(loan_amount)
debt_score_ratio = debt_to_income_ratio / credit_score
grade_num = map(grade_subgrade)
combined_rating = grade_num + (1 - subgrade/10)
```

–î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–π—Ç–∏–Ω–≥–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (`grade_num`, `combined_rating`, `default_rate`),  
—á—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ —É–ª—É—á—à–∏—Ç—å ROC-AUC –Ω–∞ **+0.004**.

### 3. **–ú–æ–¥–µ–ª—å**
- CatBoost —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –∫–ª–∞—Å—Å–æ–≤ (`auto_class_weights='Balanced'`)  
- 5-Fold Stratified Cross-Validation  
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–∞ –ø–æ F1-score (–ª—É—á—à–∏–π –ø–æ—Ä–æ–≥ = 0.20 ‚Üí F1 = 0.9446)

### 4. **SHAP –∞–Ω–∞–ª–∏–∑ –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏**

üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω **SHAP (SHapley Additive Explanations)** –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –≤–∫–ª–∞–¥–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è CatBoost.  

**–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:**
- `employment_status` ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ *Employed* –∏ *Self-employed* –ø–æ–≤—ã—à–∞—é—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–ø–ª–∞—Ç—ã –∫—Ä–µ–¥–∏—Ç–∞, —Ç–æ–≥–¥–∞ –∫–∞–∫ *Unemployed* –∏ *Student* —Å–Ω–∏–∂–∞—é—Ç.  
- `credit_risk_index` ‚Äî —á–µ–º –≤—ã—à–µ –∏–Ω–¥–µ–∫—Å, —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞. –ù–∏–∑–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî —Å–∏–≥–Ω–∞–ª –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞.  
- `debt_to_income_ratio` ‚Äî —á–µ–º –≤—ã—à–µ –¥–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Ö–æ–¥–∞, —Ç–µ–º —Ö—É–∂–µ –ø—Ä–æ–≥–Ω–æ–∑.  

üìà –ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `grade_subgrade √ó employment_status` –≤–∏–¥–Ω–æ:
- –ö–ª–∞—Å—Å—ã A‚ÄìB –∏–º–µ—é—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ SHAP-–∑–Ω–∞—á–µ–Ω–∏—è ‚Üí –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫.  
- –ö–ª–∞—Å—Å—ã D‚ÄìF ‚Äî –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ SHAP-–∑–Ω–∞—á–µ–Ω–∏—è ‚Üí –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –¥–µ—Ñ–æ–ª—Ç–∞.  
- –ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º `grade_subgrade` —Å—Ç–∞—Ç—É—Å –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Ä–∏—Å–∫:
  - **–†–∞–±–æ—Ç–∞—é—â–∏–µ (Employed)** ‚Äî –º–æ–¥–µ–ª—å ‚Äú–¥–æ–≤–µ—Ä—è–µ—Ç‚Äù, –∏—Ö SHAP –±–ª–∏–∂–µ –∫ –Ω—É–ª—é.  
  - **–ë–µ–∑—Ä–∞–±–æ—Ç–Ω—ã–µ –∏ —Å—Ç—É–¥–µ–Ω—Ç—ã** ‚Äî —É—Å–∏–ª–∏–≤–∞—é—Ç —Ä–∏—Å–∫ –¥–∞–∂–µ –ø—Ä–∏ —Ö–æ—Ä–æ—à–µ–º —Ä–µ–π—Ç–∏–Ω–≥–µ.

 **–ò—Ç–æ–≥:**  
> –ú–æ–¥–µ–ª—å –Ω–µ —Ç–æ–ª—å–∫–æ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –∫—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥, –Ω–æ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏.  
> –î–∞–∂–µ –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º —Ä–µ–π—Ç–∏–Ω–≥–µ –∑–∞–Ω—è—Ç–æ—Å—Ç—å –∏ —É—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞ –∑–∞–º–µ—Ç–Ω–æ –º–µ–Ω—è—é—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–ø–ª–∞—Ç—ã –∫—Ä–µ–¥–∏—Ç–∞.  

---

## üìà –§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|-----------|
| Accuracy | 0.872 |
| F1-score | 0.944 |
| Recall | 0.892 |
| ROC-AUC | **0.923** |

---

###  –¢–æ–ø-10 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

| –ü—Ä–∏–∑–Ω–∞–∫ | –í–∞–∂–Ω–æ—Å—Ç—å |
|----------|-----------|
| employment_status | **58.64%** |
| debt_to_income_ratio | 13.27% |
| credit_risk_index | 10.99% |
| credit_score | 7.18% |
| debt_score_ratio | 2.50% |
| interest_rate | 1.65% |
| log_loan_amount | 1.25% |
| log_annual_income | 0.90% |
| loan_amount | 0.90% |
| loan_income_stress | 0.81% |

---

##  –≠–≤–æ–ª—é—Ü–∏—è –º–æ–¥–µ–ª–∏

```
v1: Baseline CatBoost (–±–µ–∑ FE)         ‚Üí ROC-AUC = 0.919
v2: + Feature Engineering               ‚Üí ROC-AUC = 0.9228
v3: + Cross Validation (5-Fold)         ‚Üí ROC-AUC = 0.9230
v4: + –ü–æ—Ä–æ–≥ F1 + proba submit           ‚Üí ROC-AUC = 0.92322 
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
loan-payback/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ train.csv
‚îÇ   ‚îú‚îÄ‚îÄ test.csv
‚îÇ   ‚îî‚îÄ‚îÄ sample_submission.csv
‚îú‚îÄ‚îÄ ipynb/
‚îÇ   ‚îî‚îÄ‚îÄ loan-payback-catboost.ipynb
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ catboost_loanpayback_final.cbm
‚îú‚îÄ‚îÄ output/
‚îÇ   ‚îú‚îÄ‚îÄ feature_importance.png
‚îÇ   ‚îî‚îÄ‚îÄ submission_v3.csv
‚îî‚îÄ‚îÄ README.md
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
git clone https://github.com/vulcan4ik/loan-payback-prediction.git
cd loan-payback-prediction
pip install -r requirements.txt
jupyter lab ipynb/loan-payback-catboost.ipynb
```

---

## ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏

1. **Feature Engineering (12 –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤)**  
2. **PHIK –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π**  
3. **Balanced CatBoost** –¥–ª—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤  
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–∞ –ø–æ F1-score**  
5. **–ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è (5-Fold)** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏  

---

## üîÆ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] Optuna –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤  
- [ ] –ê–Ω—Å–∞–º–±–ª–∏ (LightGBM + CatBoost)  
- [ ] –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π  
- [ ] MLflow pipeline  

---

##  –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

![Python](https://img.shields.io/badge/Python-3.11-3776AB?style=flat)
![CatBoost](https://img.shields.io/badge/CatBoost-FFCC00?style=flat)
![Pandas](https://img.shields.io/badge/Pandas-150458?style=flat)
![Scikit-learn](https://img.shields.io/badge/Scikit--learn-F7931E?style=flat)
![Seaborn](https://img.shields.io/badge/Seaborn-4C8CBF?style=flat)

---

<div align="center">

**Kaggle Playground Series S5E11 | ROC-AUC = 0.92322**  
–ú–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞ –Ω–∞ CatBoost

[üîó Kaggle Leaderboard](https://www.kaggle.com/competitions/playground-series-s5e11)

</div>


